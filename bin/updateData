#!/bin/bash
#
# Update data
#
# Main script for building/updating the data files used by the viewer.
#

source Configuration

#
mkdir -p ${WORKINGDIR}

# Copy the genomeSets file to the dataDir. This defines named sets of genomes
# and will have cooresponding buttons in the browser for easy selection.
cp "${BIN}/genomeSets.tsv" "${WORKINGDIR}/genomeSets.tsv"

# Generate feature files
${PYTHON} "${BIN}/getDataFromMouseMine.py" "${WORKINGDIR}"

# Generate synteny blocks
${PYTHON} "${BIN}/sb.py" --dir "${WORKINGDIR}" > "${WORKINGDIR}/blocks.tsv"

# Write timestamp
tsfile="${WORKINGDIR}"/TIMESTAMP.tsv
echo "TIMESTAMP" > "${tsfile}"
echo `date` >> "${tsfile}"

# Switcheroo
mv -f "${OUTDIR}" "${PREVDIR}"
mv -f "${WORKINGDIR}" "${OUTDIR}"

# THE END
