#!/bin/bash
#
# generateBlockFiles
#
# For every distinct pair of feature files, A and B, in the data directory, this script
# generates a file of synteny blocks. The block files are written to the data directory.
# Each block file's name consists of the A and B file basenames, separated by a dash ("-"),
# with a ".tsv" extension. So for example, if A and B are "mus_musculus_akrj.gff3"
# and "mus_musculus_balbcj.gff3", respectively, the block file is named
# "mus_musculus_akrj-mus_musculus_balbcj.tsv".
#

source config.sh

datadir=${DIR}/data/genomedata
outdir=${DIR}/data/blockfiles

mkdir -p ${outdir}

# get the list of feature files
declare -a arr=(`ls ${datadir}/mus_*-features.tsv`)

# 
lim=$((${#arr[@]} - 1))

# nested for loop, 
#   for (i = 0; i < length of list; i++)
#       for (j = i+1; j < length of list; j++)
#           generate synteny blocks for file[i] and file[j]
ofn="blocks.tsv"
rm -f ${outdir}/${ofn}
touch ${outdir}/${ofn}
for i in `seq 0 ${lim}`; do
    noheader="--noheader"
    if [ ${i} -eq 0 ]; then
	# First time thru. Make sure file is empty. Also, generate header line.
	noheader=""
    fi
    # extract the A genome name
    a=${arr[$i]}
    afn=$(basename "${a}")
    afn="${afn%.*}"
    an="${afn%-features}"
    jstart=$(($i))
    if [ ${jstart} -le ${lim} ]; then
        for j in `seq ${jstart} ${lim}`; do
            # extract the B genome name
            b=${arr[$j]}
            bfn=$(basename "${b}")
            bfn="${bfn%.*}"
	    bn="${bfn%-features}"
            # here we go...
	    echo python sb.py ${noheader} --af ${a} --an ${an} --bf ${b} --bn ${bn} 
	    python sb.py ${noheader} --af ${a} --an ${an} --bf ${b} --bn ${bn} >> ${outdir}/${ofn}
        done
    fi
done    

